#!/bin/bash

function compile {
    mkdir -p .build
    
    cd .build
    
    cmake ..

#target 3rdparty
    cmake --build . --target Vulkan
    cmake --build . --target GLFW
    
# first target
    cmake --build . --target Vk.Multisampler
    cmake --build . --target Vk.DynamicState
    cmake --build . --target Vk.ColorBlender 
    cmake --build . --target Vk.VertexBuffer
    cmake --build . --target Vk.Rasterizer
    cmake --build . --target App.Settings
    cmake --build . --target Vk.Assembly
    cmake --build . --target App.Window
    cmake --build . --target Vk.Checker
    cmake --build . --target Vk.Getter

#second target
    cmake --build . --target Vk.Extensions

# third target
    cmake --build . --target Vk.PhysicalDevice 
    cmake --build . --target Vk.Instance

# fourth target
    cmake --build . --target Vk.WindowSurface
    cmake --build . --target Vk.LogicalDevice

# fifth target
    cmake --build . --target Vk.Layout
    cmake --build . --target Vk.Shader  
    cmake --build . --target App.ShaderFactory
    cmake --build . --target Vk.Swapchain
    cmake --build . --target Vk.Viewport
    cmake --build . --target Vk.Queue
    cmake --build . --target Vk.ColorAttachment
    cmake --build . --target Vk.RenderPass

# sixth target
    cmake --build . --target Vk.Pipeline
    cmake --build . --target Vk.Viewport

# seventh target
    cmake --build . --target App.RenderDevice

# main target
    cmake --build . -j7 --target VKEngine



    cd ..
} 

function clear {
    rm -rf .build/
}

function help {
    echo "-r  or --run      = run VKEngine"
    echo "-c  or --clear    = clear all build files"
    echo "-b  or --build    = build project"
    echo "-rb or --rebuild  = totaly rebuild all project"
}

if [[ "$1" == "--clear" || "$1" == "-c" ]]; then
    clear
fi


if [[ "$1" == "--build" || "$1" == "-b" ]]; then
    compile
fi


if [[ "$1" == "--rebuild" || "$1" == "-rb" ]]; then
    clear
    compile
fi

if [[ "$1" == "--help" || "$1" == "-h" ]]; then
    help    
fi

if [[ "$2" == "--run" || "$2" == "-r" || "$1" == "" ]]; then
    ./.build/src/VKEngine
fi
